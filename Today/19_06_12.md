TIL :: 19_06_12

# TODO
- kubernetes
  - [x] kubernetes ALB ingress controller check
  - [ ] 기존 배포 흐름 이해
  - [ ] kubernetes 배포 흐름에 녹여보기

  - [x] kiam 설정해보기
  - [ ] offline에서 aws-iam-authenticator 테스트하기
  - [ ] eks 질문 리스트 작성
  - [ ] eks external snat 테스트 해보기
  - [ ] 사설 ca 등록하는 방법

  - [x] kubernetes 모니터링 EFK
  - [ ] node의 /var/lib/docker 용량이 부족했을 때의 노티 -> metric beat 사용해보기
  - [x] elasticsearch opensource auth 기능 검토
  - [ ] fluentd로 컨테이너 별 es index 할 수 있는지 검토
  - [ ] fluentd에 es id/pass secret으로 빼기
  - [ ] es statefulSet으로 올리기
  - [ ] grafana에서 es 얹어보기

- PIR
  - [x] 서버 지급 확인
  - [ ] 계정신청
  - [ ] 로그인 기능
  - [ ] incident create시 iam api 연동
  - [ ] incident create시 incident num
  - [ ] incident detail history 보여 주기

- BACKLOG
  - [ ] vpc ip 부족할 시 noti 받아보기
  - [ ] aws eks에서 networkPolicy 동작 잘하는지 체크
  - [x] kubeconfig에서 ec2 role 사용하기

- Question
  - [ ] aws EKS의 client CA는 수정 가능?
  - [ ] amazon-vpc-cni-k8s 동작 방식
  - [ ] worker의 eni가 부족했을 때 알람 받는 방법




```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-problem-detector
  labels:
    app: node-problem-detector
spec:
  selector:
    matchLabels:
      app: node-problem-detector
  template:
    metadata:
      labels:
        app: node-problem-detector
    spec:
      containers:
      - name: node-problem-detector
        command:
        - /node-problem-detector
        - --logtostderr
        - --system-log-monitors=/config/kernel-monitor.json,/config/docker-monitor.json
        image: k8s.gcr.io/node-problem-detector:v0.6.3
        resources:
          limits:
            cpu: 10m
            memory: 80Mi
          requests:
            cpu: 10m
            memory: 80Mi
        imagePullPolicy: Always
        securityContext:
          privileged: true
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        volumeMounts:
        - name: log
          mountPath: /var/log
          readOnly: true
        - name: kmsg
          mountPath: /dev/kmsg
          readOnly: true
        - name: localtime
          mountPath: /etc/localtime
          readOnly: true
        - name: config
          mountPath: /config
          readOnly: true
      volumes:
      - name: log
        hostPath:
          path: /var/log/
      - name: kmsg
        hostPath:
          path: /dev/kmsg
      - name: localtime
        hostPath:
          path: /etc/localtime
      - name: config
        configMap:
          name: node-problem-detector-config
          items:
          - key: kernel-monitor.json
            path: kernel-monitor.json
          - key: docker-monitor.json
            path: docker-monitor.json
```
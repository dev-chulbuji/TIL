TIL :: 19_06_11

# TODO
- kubernetes
  - [x] kubernetes ALB ingress controller check
  - [ ] 기존 배포 흐름 이해
  - [ ] kubernetes 배포 흐름에 녹여보기

  - [ ] kubernetes 모니터링 EFK
  - [x] kiam 설정해보기
  - [ ] offline에서 aws-iam-authenticator 테스트하기

- PIR
  - [ ] 로그인 기능
  - [ ] incident create시 iam api 연동
  - [ ] incident create시 incident num
  - [ ] incident detail history 보여 주기

- BACKLOG
  - [ ] vpc ip 부족할 시 noti 받아보기
  - [ ] aws eks에서 networkPolicy 동작 잘하는지 체크
  - [x] kubeconfig에서 ec2 role 사용하기

- Question
  - [ ] aws EKS의 client CA는 수정 가능?
  - [ ] vpc-cni 동작 방식

# cer-manager
```bash
kubectl create namespace cert-manager
kubectl label namespace cert-manager certmanager.k8s.io/disable-validation=true
kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.8.0/cert-manager.yaml --validate=false
```

```yaml
apiVersion: certmanager.k8s.io/v1alpha1
kind: Issuer
metadata:
  name: kiam-selfsigning-issuer
  namespace: kube-system
spec:
  selfSigned: {}
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: kiam-ca
  namespace: kube-system
spec:
  secretName: kiam-ca
  commonName: "kiam-ca"
  isCA: true
  issuerRef:
    name: kiam-selfsigning-issuer
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: Issuer
metadata:
  name: kiam-ca-issuer
  namespace: kube-system
spec:
  ca:
    secretName: kiam-ca
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: kiam-agent
  namespace: kube-system
spec:
  secretName: kiam-agent-tls
  issuerRef:
    name: kiam-ca-issuer
  commonName: kiam
---
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: kiam-server
  namespace: kube-system
spec:
  secretName: kiam-server-tls
  issuerRef:
    name: kiam-ca-issuer
  dnsNames:
   - localhost
   - kiam-server
  ipAddresses:
   - 127.0.0.1
```
